# IP
Лабараторное задание №4 по работе с IP.

## Задание
1. [Разработать и задокументировать адресное пространство для лабораторного стенда](#chapter-0)
2. [Настроить ip адреса на каждом активном порту](#chapter-1)
4. [Настроить каждый VPC в каждом офисе в своем VLAN](#chapter-2)
5. [Настроить VLAN управления для сетевых устройств](#chapter-3)
6. [Настроить сети офисов так, чтобы не возникало broadcast штормов, а использование линков было максимально оптимизировано](#chapter-4)

<a id="chapter-0"></a>
## Адресное пространство

Вся сеть была разделена на 5 зон, в соотвествии было распределение адресного пространства.
IPv4 адреса имеют общий вид 10.X.Y. где X указывает на зону, а Y на назначение подсети.

Параметр | 0 | 1 | 2 | 3 | 4 |
--- | --- | --- | --- | --- | --- 
X | Москва | Ламас+Киторн | Триада+Лабытнанги | С.-Петербург | Чокурдах 
Y | Клиентская сеть 1 | Клиентская сеть 2 | Управление коммутаторов | Меж роутерные линки | Роутеры 

К примеру IP 10.0.2.4 - Интерфейс управления коммутатора SW4 в Москве.

<a id="chapter-1"></a>
## Таблица ip адресов на интерфейсах маршрутизаторов

Устройство | Порт | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- | --- 
R12 | lo0 | 10.0.4.12/32 |  |
R12 | e0/0 | 10.0.3.1/30 |  |
R12 | e0/1 | 10.0.3.5/30 |  |
R12 | e0/2 | 10.0.3.13/30 |  |
R12 | e0/3 | 10.0.3.9/30 |  |
R13 | lo0 | 10.0.4.13/32 |  |
R13 | e0/0 | 10.0.3.21/30 |  |
R13 | e0/1 | 10.0.3.17/30 |  |
R13 | e0/2 | 10.0.3.29/30 |  | 
R13 | e0/3 | 10.0.3.25/30 |  | 
R14 | lo0 | 10.0.4.14/32 |  | 
R14 | e0/0 | 10.0.3.14/30 |  | 
R14 | e0/1 | 10.0.3.26/30 |  | 
R14 | e0/2 | 10.0.3.45/30 |  | 
R14 | e0/3 | 10.0.3.41/30 |  | 
R15 | lo0 | 10.0.4.15/32 |  | 
R15 | e0/0 | 10.0.3.30/30 |  | 
R15 | e0/1 | 10.0.3.10/30 |  | 
R15 | e0/2 | 10.0.3.37/30 |  | 
R15 | e0/3 | 10.0.3.33/30 |  | 
R19 | lo0 | 10.0.4.19/32 |  | 
R19 | e0/0 | 10.0.3.42/30 |  | 
R20 | lo0 | 10.0.4.20/32 |  | 
R20 | e0/0 | 10.0.3.34/30 |  | 
R21 | lo0 | 10.1.4.21/32 |  | 
R21 | e0/0 | 10.0.3.38/30 |  | 
R21 | e0/1 | 10.1.3.1/30 |  | 
R21 | e0/2 | 10.2.3.6/30 |  |  
R22 | lo0 | 10.1.4.22/32 |  | 
R22 | e0/ | 10.0.3.46/30 |  | 
R22 | e0/ | 10.1.3.2/30 |  | 
R22 | e0/ | 10.2.3.14/30 |  | 
R23 | lo0 | 10.2.4.23/32 |  | 
R23 | e0/0 | 10.2.3.13/30 |  | 
R23 | e0/1 | 10.2.3.17/30 |  | 
R23 | e0/2 | 10.2.3.10/30 |  | 
R24 | lo0 | 10.2.4.24/32 |  | 
R24 | e0/0 | 10.2.3.5/30 |  | 
R24 | e0/1 | 10.2.3.2/30 |  | 
R24 | e0/2 | 10.2.3.9/30 |  | 
R24 | e0/3 | 10.3.3.30/30 |  |  
R25 | lo0 | 10.2.4.25/32 |  | 
R25 | e0/0 | 10.2.3.18/30 |  | 
R25 | e0/1 | 10.2.3.25/30 |  | 
R25 | e0/2 | 10.2.3.21/30 |  | 
R25 | e0/3 | 10.2.3.29/30 |  |  
R26 | lo0 | 10.2.4.26/32 |  | 
R26 | e0/0 | 10.2.3.1/30 |  | 
R26 | e0/1 | 10.2.3.33/30 |  | 
R26 | e0/2 | 10.2.3.22/30 |  | 
R26 | e0/3 | 10.3.3.34/30 |  |  
R27 | lo0 | 10.2.4.27/32 |  | 
R27 | e0/0 | 10.2.3.26/30 |  | 
R16 | lo0 | 10.3.4.16/32 |  | 
R16 | e0/0 | 10.3.3.1/30 |  | 
R16 | e0/1 | 10.3.3.13/30 |  | 
R16 | e0/2 | 10.3.3.9/30 |  | 
R16 | e0/3 | 10.3.3.5/30 |  |  
R17 | lo0 | 10.3.4.17/32 |  | 
R17 | e0/0 | 10.3.3.17/30 |  | 
R17 | e0/1 | 10.3.3.25/30 |  | 
R17 | e0/2 | 10.3.3.21/30 |  |  
R18 | lo0 | 10.3.4.18/32 |  | 
R18 | e0/0 | 10.3.3.14/30 |  | 
R18 | e0/1 | 10.3.3.26/30 |  | 
R18 | e0/2 | 10.3.3.29/30 |  | 
R18 | e0/3 | 10.3.3.33/30 |  |   
R32 | lo0 | 10.3.4.32/32 |  | 
R32 | e0/0 | 10.3.3.6/30 |  | 
R28 | lo0 | 10.4.4.28/32 |  | 
R28 | e0/0 | 10.2.3.34/30 |  | 
R28 | e0/1 | 10.2.3.30/30 |  | 
R28 | e0/2.10 | 10.4.2.1/24 |  | 
R28 | e0/2.20 | 10.4.0.1/24 |  | 
R28 | e0/2.21 | 10.4.1.1/24 |  | 
SW4 | e1/0 | 10.0.3.2/30 |  | 
SW4 | e1/1 | 10.0.3.18/30 |  | 
SW4 | Vlan20 | 10.0.0.4/24 |  |
SW4 | Vlan21 | 10.0.1.4/24 |  |
SW5 | e1/0 | 10.0.3.22/30 |  | 
SW5 | e1/1 | 10.0.3.6/30 |  | 
SW5 | Vlan20 | 10.0.0.5/24 |  |
SW5 | Vlan21 | 10.0.1.5/24 |  |
SW9 | e0/3 | 10.3.3.18/30 |  | 
SW9 | e1/0 | 10.3.3.10/30 |  | 
SW9 | Vlan20 | 10.3.0.1/24 |  |
SW10 | e0/3 | 10.3.3.2/30 |  | 
SW10 | e1/0 | 10.3.3.22/30 |  | 
SW10 | Vlan21 | 10.3.1.1/24 |  |

<a id="chapter-2"></a>
## Настрока VPC в каждом офисе в своем VLAN

Для клиентов выделы два VLAN c номерами 20 и 21
Устройство | VLAN | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- | --- 
VPC1 | 20 | 10.0.0.11/24 |  |  
VPC7 | 21 | 10.0.1.11/24 |  |  
VPC8 | 20 | 10.3.0.11/24 |  |  
VPC | 21 | 10.3.1.11/24 |  |  
VPC30 | 20 | 10.4.0.30/24 |  |  
VPC31 | 21 | 10.4.1.31/24 |  | 

Для зон 0 и 3 настроена возможность получения адресов по DHCP. Для маршрутизации используется шлюз по умолчанию с первым адресом сети.

<a id="chapter-3"></a>
## Настройка VLAN управления для сетевых устройств

Для коммутаторов выделен VLAN управления с номером 10 
Устройство | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- 
SW4 | 10.0.2.4 |  |  
SW5 | 10.0.2.5 |  |  
SW9 | 10.3.2.9 |  |  
SW10 | 10.3.2.10 |  |  
SW2 | 10.0.2.2 |  |  
SW3 | 10.0.2.3 |  |   
SW29 | 10.4.2.29 |  | 

Для возможности удаленного управления SW2-3 и SW29, на этих коммутаторах настроен шлюз по умолчанию с первым адресом сети управления.
Для резервирования этого шлюза в зоне Москва, был поднят hsrp домен на коммутаторах SW4-5.

<a id="chapter-4"></a>
##Настройка L2 сети и резервирование

На L2 уровне избыточность имеется в зонах Москва и С.-Петербург.
В С.-Петербурге был организован etherchannel между коммутаторами SW9-10
```
SW10#show etherchannel 1 summary 
Flags:  D - down        P - bundled in port-channel
        I - stand-alone s - suspended
        H - Hot-standby (LACP only)
        R - Layer3      S - Layer2
        U - in use      N - not in use, no aggregation
        f - failed to allocate aggregator

        M - not in use, minimum links not met
        m - not in use, port not aggregated due to minimum links not met
        u - unsuitable for bundling
        w - waiting to be aggregated
        d - default port

        A - formed by Auto LAG


Number of channel-groups in use: 1
Number of aggregators:           1

Group  Port-channel  Protocol    Ports
------+-------------+-----------+-----------------------------------------------
1      Po1(SU)         LACP      Et0/0(P)    Et0/1(P) 
```
В Москве так же был организован etherchannel. Для эффективного использования избыточных L2 каналов, настроено spaning-tree в режиме mst. Для разных групп вланов используются различные пути.
К примеру топология на SW2 для группу с vlan 21
```
MST21
  Spanning tree enabled protocol mstp
  Root ID    Priority    24597
             Address     aabb.cc00.4000
             Cost        1000
             Port        2 (Ethernet0/1)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec

  Bridge ID  Priority    32789  (priority 32768 sys-id-ext 21)
             Address     aabb.cc00.2000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec

Interface           Role Sts Cost      Prio.Nbr Type
------------------- ---- --- --------- -------- --------------------------------
Et0/0               Desg FWD 2000000   128.1    Shr 
Et0/1               Root FWD 1000      128.2    Shr 
Et0/2               Desg FWD 2000000   128.3    Shr Edge 
```
В результате клиентские vlan имеют по одному активному линку к каждому L3 коммутатору(SW4,5). В дополнение к этому на SW4 и SW5 реализовано резервирование шлюза по умолчанию с балансировкой нагрузки при помощи протокола glbp.
